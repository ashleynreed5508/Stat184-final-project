---
title: "Stat 184 Final Project"
author: "Ashley Reed"
subtitle: "Chicago Crime: 2001 to Present"
output: html_notebook
---

In this project, I will be analyzing data collected by the Chicago Police Department that was posted for public access on the Chicago Data Portal. This data set contained 6.75 million cases providing information on 22 different variables. Each case represents a reported crime. 

The variables include:

* ID (Unique ID numbers for each reported crime)
* Case number (Unique combinations of numbers and letters used by the Chicago Police Department to identify cases)
* Date
* Block
* IUCR (Illinois Uniform Crime Reporting code)
* Primary Type (general description of IUCR code)
* Description (detailed description of IUCR code)
* Location Description
* Arrest (true or false)
* Domestic (true of false)
* Beat
* District
* Ward
* Community Area
* FBI Code
* X-coordinate (location)
* Y-coordinate (location)
* Year
* Updated On (date of last update)
* Latitude
* Longitude 
* Location

### Front Matter

```{r}
rm(list = ls())

library(rvest)
library(tidyverse)
library(tidyr)
library(mosaic)
library(lubridate)
library(DataComputing)
library(readr)
library(lubridate)
library(knitr)

```

### Reading in the Data

```{r}

ChicagoCrimeOriginal <-
read_csv("Crimes_-_2001_to_present.csv")

# Reading in data from the Chicago Data Portal to create a new data frame in R -------------------

``` 

```{r}

ChicagoCrimeOriginal

```

### Cleaning the Data

In order to clean up the data to make it tidy and ready for analysis, I renamed the variables to fit standard data conventions in R programming, changed variable formats to fit what they contain (ex. dates, logical values, etc.), and removed the X or XX included in addresses under the block variable.

```{r}

ChicagoCrime <-
ChicagoCrimeOriginal %>%
  rename(id = ID, 
         case_number = `Case Number`, 
         date = Date, 
         block = Block, 
         iucr = IUCR, 
         primary_type = `Primary Type`,
         description = Description,
         location_description = `Location Description`,
         arrest = Arrest,
         domestic = Domestic,
         beat = Beat,
         district = District,
         ward = Ward,
         community_area = `Community Area`,
         fbi_code = `FBI Code`,
         x_coordinate = `X Coordinate`,
         y_coordinate = `Y Coordinate`,
         year = Year,
         updated = `Updated On`,
         lat = Latitude,
         long = Longitude,
         location = Location) %>%
  mutate(date = lubridate::mdy_hms(date),
         arrest = as.logical(arrest),
         domestic = as.logical(domestic),
         beat = as.integer(beat),
         district = as.integer(district),
         block = gsub("X|XX","", block))

# Cleaning Chicago Crime data to fit standard conventions and simplify further work  -----------------------

ChicagoCrime 

```

### Analysis

Now that I have cleaned up the data, I will use data wrangling to analyze the data and come to some meaningful conclusions. I'm curious to find out more about crime rates (specifically in terms of arrests) over the years, so I will create a plot of years vs. number of crimes, and plot crimes resulting in arrest and crimes not resulting in arrest seperately.

```{r}

ChicagoCrimeYears <-
  ChicagoCrime %>%
  group_by(year, arrest) %>%
  summarise(count = n()) 

# Calculating the number of reported crimes committed each year ---------------

ChicagoCrimeYears %>%
  ggplot(aes(x = year, y = count, color = arrest)) +
  geom_point() +
  geom_line() 

# Plotting the number of crimes committed each year in terms of arrest vs the year

```

The resulting plot comes out with some very interesting results.  While I had expected that crime rates would show an increase as the years progressed, this shows the exact opposite. The number of crimes committed each year in Chicago is at a high from around 2001-2005, and then proceeds to decrease relatively consistently, except for a few isolated peaks, until it reaches an ultimate minimum value in 2018.  

In addition, it seems that many more crimes take place in Chicago that lead to no arrest that crimes resulting in an arrest. I had assumed the opposite would be true when creating this plot. In certain years, there were almost triple the number of crimes with an arrest that did not result in arrest.  

Overall, this plot could be seen as relatively good news; from the trends shown here, we could reasonable hypothesize that crimes will continue to decrease in Chicago in the coming years.

------------------------------------------------------------

Next, I would like to observe the difference in number of total crimes committed over the years in each Chicago District in terms of arrest. I am anticipating that there will be certain districts in Chicago that are more dangerous than others (in terms of number of crimes committed).

```{r}
 
ChicagoCrimeTotals <-
ChicagoCrime %>%
  select(district, arrest) %>%
  group_by(district, arrest) %>%
  summarise(count = n()) 

# Calculating the total number of crimes committed in each district resulting in arrest and not resulting in arrest --------------

ChicagoCrimeTotals %>%
  filter(arrest == "TRUE") %>%
  arrange(desc(count)) %>%
  head(5)

ChicagoCrimeTotals %>%
  filter(arrest == "FALSE") %>%
  arrange(desc(count)) %>%
  head(5)

# Manually finding the 5 districts with the highest number of crimes resulting in arrest and the 5 districts with the highest number of crimes not resulting in arrest -----------------

ChicagoCrimeTotals %>%
  ggplot(aes(x = district, y = count)) +
  geom_col(aes(fill = arrest), position = "dodge") +
  scale_x_continuous(breaks = 
                     c(1,3,5,7,9,11,13,15,17,19,21,23,25),
                     limits = c(1,25))

# Plotting the number of crimes (with respect to arrest) against the district they were committed in

```

This plot shows that there are certainly some districts in which many more crimes are committed than others. While this plot gives a nice visualization of the districts with the most crime in terms of arrest, it is also helpful to manually calculate the districts with the most crime. In doing this, it can be seen that districts 11, 15, 7, 25, and 8 have the highest number of crimes resulting in arrest, and districts 8, 4, 6, 7, and 25 have the highest number of crimes not resulting in arrest. This can be seen on the plot as well. Interestingly, districts 7 and 25 appear on both top 5 lists, so it seems that these districts are relatively dangerous, as they have many crimes being committed both resulting and not resulting in arrest.

-----------------------------------------------------------

Lastly, I would like to find out if month/time of year has anything to do with the number of crimes committed for certain types of crimes. I will find the 4 most common crimes committed in Chicago and analyze the prevalence of their occurence in each month in terms of arrest. I expect to see that certain crimes occur more heavily at certain times of the year.

```{r}

pattern <- "\\d{4}\\-(\\d{2})"

ChicagoCrimeMonth <-
ChicagoCrime %>%
  filter(grepl(pattern, date)) %>%
  tidyr::extract(date, into = "month", regex = pattern) %>%
  mutate(month = as.integer(month))

# Extracting the month from the date that each crime was committed and putting it into a new variable called `month` ----------- 

ChicagoCrime %>%
  group_by(primary_type) %>%
  summarise(count = n()) %>%
  filter(rank(desc(count)) <= 4)  

# Ranking the primary types of crimes by their prevalence in the data and printing out the top 4 for further analysis --------

ChicagoMonthGlyphReady <-
ChicagoCrimeMonth %>%
  select(primary_type, arrest, month) %>%
  filter(primary_type %in% c("THEFT", "BATTERY", "NARCOTICS", "CRIMINAL DAMAGE")) %>%
  group_by(primary_type, arrest, month) %>%
  summarise(count = n()) 

# Creating a new data table only containing the 4 most common types of crimes and showing the total counts of each type of crime in each month of the year with respect to arrest --------
  
ChicagoMonthGlyphReady %>%
  ggplot(aes(x = month, y = count)) +
  geom_col(aes(fill = arrest), position = "dodge") +
  scale_x_continuous(breaks = c(1:12)) +
  facet_wrap(primary_type ~ .)

# Plotting total number of crimes for each primary type in terms of arrest against the month ---------

```

This plot shows that the occurrence of certain crimes peaks during certain times of the year. Theft seems to become more frequent in the summer months and battery seems to be most frequent in the late spring and early summer months.  Criminal damage also becomes slightly more frequent in the summer months.  This could possibly be attributed to warmer weather or more free time in these months (depending on the age of the people committing these crimes).

Narcotics crimes are the only ones that show no difference in frequency in different months/times of the year. This would make sense, because people addicted to narcotics are not more motivated to use them at certain times of the year.  

Another interesting thing that can be seen from this plot is that the crimes committed resulting in arrest do not fluctuate in frequency the way that crimes not resulting in arrest do. For all of the 4 most common types of crimes, the number of occurrences for each month remains relatively consistent throughout the entiretly of the year.
